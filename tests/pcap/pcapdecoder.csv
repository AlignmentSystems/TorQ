action,ms,bytes,lang,code,repeat,minver,comment
before,0,0,q,"testpcapfolder:getenv[`KDBTESTS],""/pcap""",1,,
before,0,0,q,"quote:get hsym `$testpcapfolder,""/dummyquotetable""",1,,"Load table of dummy quotes"
before,0,0,q,"packets:get hsym `$testpcapfolder,""/dummypacketstab""",1,,"Load table of dummy packets manually made from data taken from wireshark"
before,0,0,q,rdbhandle:.servers.gethandlebytype[`rdb;`any],1,,"Open handle to rdb"
before,0,0,q,"pcapfile:hsym `$testpcapfolder,""/dummy.pcap""",1,,"Get handle to dummy pcap file"
run,0,0,q,packets~.pcap.buildtable[pcapfile],1,,"Check buildtable produces the expected table from pcap file"
run,0,0,q,sendtotickerplant[`quote;quote[cols[quote]]],1,,"Send dummy quote table to tickerplant"
true,0,0,q,quote~rdbhandle"select from quote",1,,"Check rdb correctly received quote table"
run,0,0,q,FArun[],1,,"Search for pcap files and run processpcaps function"
true,0,0,q,.pcap.buildtable[pcapfile]~rdbhandle"select from packets",1,,"Check rdb correctly received packets table"
run,0,0,q,processedtab:get hsym `$alreadyprocessed,1,,"Load in the already processed table"
true,0,0,q,(1_string[pcapfile])~first exec filename from processedtab,1,,"Check the dummy pcap file is in the alreadyprocessed table"
after,0,0,q,.os.deldir[alreadyprocessed],1,,"Delete filealerterprocessed folder from test folder"
after,0,0,q,rdbhandle"quote:0#quote",,"Clear quote table"
after,0,0,q,rdbhandle"packets:0#packets",,"Clear packets table"
