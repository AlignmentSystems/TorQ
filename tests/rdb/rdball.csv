action,ms,bytes,lang,code,repeat,minver,comment
before,0,0,q,.rdb.subtables:(),1,,"Clear subscription tables"
before,0,0,q,.rdb.subfiltered:0b,1,,"Turn off subscription filters"
before,0,0,q,.rdb.subscribe[],1,,"Subscribe to all data from stp"
before,0,0,q,.tst.t:count trade,1,,"Save table count"
before,0,0,q,.tst.q:count quote,1,,"Save table count"
before,0,0,q,.tst.h:first .sub.getsubscriptionhandles[.rdb.tickerplanttypes;();()!()]`w,1,,"Save handle to stp"
true,0,0,q,all (tables[]except `KUT`KUTR)in .rdb.subtables,1,,"Check subscription made for all tables"
run,0,0,q,{x[0] . (x[1];x[2])}.tst.h[],1,,"Block until updates publish"
run,0,0,q,{x[0] . (x[1];x[2])}.tst.h[],1,,"Block until updates publish"
run,0,0,q,{x[0] . (x[1];x[2])}.tst.h[],1,,"Block until updates publish"
run,0,0,q,{x[0] . (x[1];x[2])}.tst.h[],1,,"Block until updates publish"
run,0,0,q,{x[0] . (x[1];x[2])}.tst.h[],1,,"Block until updates publish"
true,0,0,q,.tst.t<count trade,1,,"Check trade table populating"
true,0,0,q,.tst.q<count quote,1,,"Check quote table populating"
after,0,0,q,".tst.h"".stpps.closesub .z.w""",1,,"Close subscription"
after,0,0,q,trade:0#trade,1,,"Clear tables"
after,0,0,q,quote:0#quote,1,,"Clear tables"
