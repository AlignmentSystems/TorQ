
<!DOCTYPE html>
<html class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="shortcut icon" href="../graphics/favicon.ico">
      
      <meta name="generator" content="mkdocs+mkdocs-material#1.0.2">
    
    
      
        <title>Analytics Library - TorQ</title>
      
    
    
      <script src="../assets/javascripts/modernizr-facb31f4a3.js"></script>
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application-1b8b9fdf68.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-02ce7adcc2.palette.css">
      
      
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="indigo" data-md-color-accent="green">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="TorQ" class=" md-logo  md-header-nav__button">
          
            <img src="../graphics/TorQ-logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
            
            Analytics Library
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <div class="md-search__overlay"></div>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false">
      <label class="md-icon md-search__icon" for="search"></label>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result"></div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            
              


  


  <a href="https://github.com/AquaQAnalytics/TorQ" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

            
          </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <i class=" md-logo  md-nav__button">
      
        <img src="../graphics/TorQ-logo.png">
      
    </i>
    TorQ
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/AquaQAnalytics/TorQ" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  <li class="md-nav__item">
    
      <a href=".." title="Home" class="md-nav__link">
        Home
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item">
    
      <a href="../Overview/" title="About" class="md-nav__link">
        About
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item">
    
      <a href="../gettingstarted/" title="Getting Started" class="md-nav__link">
        Getting Started
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item">
    
      <a href="../utilities/" title="Utilities" class="md-nav__link">
        Utilities
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item">
    
      <a href="../handlers/" title="Handlers" class="md-nav__link">
        Handlers
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item">
    
      <a href="../conn/" title="Connection Management" class="md-nav__link">
        Connection Management
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item">
    
      <a href="../Processes/" title="Processes" class="md-nav__link">
        Processes
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Analytics Library
      </label>
    
    <a href="./" title="Analytics Library" class="md-nav__link md-nav__link--active">
      Analytics Library
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ffills" title="ffills[]" class="md-nav__link">
    ffills[]
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#options" title="Options" class="md-nav__link">
    Options
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example" title="Example:" class="md-nav__link">
    Example:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pivot" title="pivot[]" class="md-nav__link">
    pivot[]
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example_1" title="Example:" class="md-nav__link">
    Example:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example_2" title="Example:" class="md-nav__link">
    Example:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intervals" title="intervals[]" class="md-nav__link">
    intervals[]
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#usage" title="Usage" class="md-nav__link">
    Usage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples" title="Examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-minute-datatype" title="Using minute datatype:" class="md-nav__link">
    Using minute datatype:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#some-examples-using-other-datatypes" title="Some examples using other datatypes:" class="md-nav__link">
    Some examples using other datatypes:
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#date" title="Date" class="md-nav__link">
    Date
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#second" title="Second" class="md-nav__link">
    Second
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timespan" title="timespan" class="md-nav__link">
    timespan
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rack" title="rack[]" class="md-nav__link">
    rack[]
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#input-parameters" title="Input parameters:" class="md-nav__link">
    Input parameters:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage_1" title="Usage" class="md-nav__link">
    Usage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_1" title="Examples" class="md-nav__link">
    Examples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
  <li class="md-nav__item">
    
      <a href="../visualisation/" title="Visualisation" class="md-nav__link">
        Visualisation
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item">
    
      <a href="../blog/" title="TorQ Blog Posts" class="md-nav__link">
        TorQ Blog Posts
      </a>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ffills" title="ffills[]" class="md-nav__link">
    ffills[]
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#options" title="Options" class="md-nav__link">
    Options
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example" title="Example:" class="md-nav__link">
    Example:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pivot" title="pivot[]" class="md-nav__link">
    pivot[]
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example_1" title="Example:" class="md-nav__link">
    Example:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example_2" title="Example:" class="md-nav__link">
    Example:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intervals" title="intervals[]" class="md-nav__link">
    intervals[]
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#usage" title="Usage" class="md-nav__link">
    Usage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples" title="Examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-minute-datatype" title="Using minute datatype:" class="md-nav__link">
    Using minute datatype:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#some-examples-using-other-datatypes" title="Some examples using other datatypes:" class="md-nav__link">
    Some examples using other datatypes:
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#date" title="Date" class="md-nav__link">
    Date
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#second" title="Second" class="md-nav__link">
    Second
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timespan" title="timespan" class="md-nav__link">
    timespan
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rack" title="rack[]" class="md-nav__link">
    rack[]
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#input-parameters" title="Input parameters:" class="md-nav__link">
    Input parameters:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage_1" title="Usage" class="md-nav__link">
    Usage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_1" title="Examples" class="md-nav__link">
    Examples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
               
                 <a href="https://github.com/AquaQAnalytics/TorQ/edit/master/docs/analyticslib.md" title="Edit this page" class="md-icon md-content__edit">edit</a>
               
              
                
                <h1 id="analytics-library">Analytics Library</h1>
<p>A set of analytical functions is provided for the simplification of common operations. This set of tools is targeted at new kdb+ developers or business users. Data visualization would be an example application of this library, as an effective visualization of data incurs various manipulations of data sets. For example, a user wishes to produce a 15 minute bucketed sample of a time series, and forward fill it, then pivot it. All of the above can be achieved with the functions defined below. </p>
<p>All functions contain usage examples, as well as an explanation on the type and form of the arguments they accept.</p>
<h2 id="ffills">ffills[]</h2>
<p>This script contains the utility to dynamically forward fill a given table keyed by given columns.
Input parameters:
* Dictionary containing:
    * <code>table</code> - Table to be forward filled
    * <code>by</code> - list of column names to key the table (optional)
    * <code>keycols</code> - list of columns names to be forward filled (optional)</p>
<p>OR </p>
<ul>
<li>Table</li>
</ul>
<p>This utility is equivalent to:
* <code>update fills col1, fills col2 ... by col2 from table</code></p>
<p>If you have a large data set or just a table with multiple columns typing this statement out can be quite laborious.
With this utility you simply specify the table or parameter dictionary and pass it to the function.
This utility also has the added functionality of being able to forward fill mixed list columns, i.e. strings.</p>
<p>To achieve this functionality a function to forward fill mixed list columns was required. This function can be seen here:</p>
<pre><code>forwardfill:{$[0h=type x;x maxs (til count x)*(0&lt;count each x);fills x]};
</code></pre>

<p>If the column is a numerical column it passes through the conditional statement and the function fills gets called. 
If the column is a mixed list then a a boolean list is created with 0's at each index in the column where the count 0 is present this is then multiplied by the indexes of each element of the column which is used as 
input to the maxs function, thereby forward filling the column. </p>
<h4 id="options">Options</h4>
<p>By specifying the <code>by</code> condition in the input dictionary the function can forward fill keyed by specific column, for example:</p>
<p>Using the following table:</p>
<pre><code>q)table
time         sym  ask bid asize bsize a id
------------------------------------------
00:00:38.184 AMD  121 12  3     30    a 1
00:01:25.332 AMD  121 3   3     30    b 4
00:09:37.574 AAPL 63  32  3     30    b 3
00:21:24.796 AAPL 63      12            4
00:38:39.521 AAPL 121 3   5           a 3
00:40:41.670 MSFT 63  3   4     20    c 4
00:48:08.048 MSFT 63            40      3
00:48:39.290 IBM  63  3   12    40    d 2
00:57:47.067 AAPL     24  3     30      2
01:08:00.945 AAPL 121 12  3     20    b 3

</code></pre>

<p>We can create the input dictionary in the following way to specify the by clause of the <code>ffill</code> utility:</p>
<pre><code>q)args:(`table`by)!(table;`sym)
</code></pre>

<p>Passing this to the function we can see the result:</p>
<pre><code>q)ffill args
time         sym  ask bid asize bsize a id
------------------------------------------
00:00:38.184 AMD  121 12  3     30    a 1
00:01:25.332 AMD  121 3   3     30    b 4
00:09:37.574 AAPL 63  32  3     30    b 3
00:21:24.796 AAPL 63  32  12    30    b 4
00:38:39.521 AAPL 121 3   5     30    a 3
00:40:41.670 MSFT 63  3   4     20    c 4
00:48:08.048 MSFT 63  3   4     40    c 3
00:48:39.290 IBM  63  3   12    40    d 2
00:57:47.067 AAPL 121 24  3     30    a 2
01:08:00.945 AAPL 121 12  3     20    b 3

</code></pre>

<p>By specifying the <code>keycols</code> condition in the input dictionary the function can forward fill only specific columns, for example:</p>
<p>Using the same data set as before we can create a new input specifying which column we want to forward fill:</p>
<pre><code>q)args:(`table`keycols)!(table;`asize)
q)ffill args
time         sym  ask bid asize bsize a id
------------------------------------------
00:00:38.184 AMD  121 12  3     30    a 1
00:01:25.332 AMD  121 3   3     30    b 4
00:09:37.574 AAPL 63  32  3     30    b 3
00:21:24.796 AAPL 63      12            4
00:38:39.521 AAPL 121 3   5           a 3
00:40:41.670 MSFT 63  3   5     20    c 4
00:48:08.048 MSFT 63      4     40      3
00:48:39.290 IBM  63  3   12    40    d 2
00:57:47.067 AAPL     24  3     30      2
01:08:00.945 AAPL 121 12  3     20    b 3

</code></pre>

<p>Note that with specifying the <code>by</code> condition the column was forward filled as it sits in the table.</p>
<p>Passing just a table into the function will forward fill all columns, for example:</p>
<pre><code>q)ffill table
time         sym  ask bid asize bsize a id
------------------------------------------
00:00:38.184 AMD  121 12  3     30    a 1
00:01:25.332 AMD  121 3   3     30    b 4
00:09:37.574 AAPL 63  32  3     30    b 3
00:21:24.796 AAPL 63  32  12    30    b 4
00:38:39.521 AAPL 121 3   5     30    a 3
00:40:41.670 MSFT 63  3   5     20    a 4
00:48:08.048 MSFT 63  3   4     40    c 3
00:48:39.290 IBM  63  3   12    40    c 2
00:57:47.067 AAPL 63  24  3     30    c 2
01:08:00.945 AAPL 121 12  3     20    b 3

</code></pre>

<h4 id="example">Example:</h4>
<p>We have the following table:</p>
<pre><code>q)table
time         sym  ask bid asize bsize a id
------------------------------------------
00:00:00.000 AAPL 73  90  3     30    a 1
00:00:00.000 AMD  123 210 67    30    b 4
00:00:00.000 IBM  34  64  87    43    b 4
00:00:00.000 MSFT 100 200 43    40    c 1
00:00:38.184 AMD  121 12  3     30    a 1
00:01:25.332 AMD  121 3   3     30    b 4
00:09:37.574 AAPL 63  32  3     30    b 3
00:21:24.796 AAPL 63      12            4
00:38:39.521 AAPL 121 3   5           a 3
00:40:41.670 MSFT 63  3         20      4
00:48:08.048 MSFT 63      4     40    c 3
00:48:39.290 IBM  63  3   12    40      2
00:57:47.067 AAPL     24  3     30      2
..
</code></pre>

<p>Create the dictionary:</p>
<pre><code>q)args:(`table`by)!(table;`sym)
q)args
table| `s#+`time`sym`ask`bid`asize`bsize`a`id!(`p#00:00:00.482 00:00:00.803 00:00..
by| `sym

</code></pre>

<p>Pass the dictionary to the function:</p>
<pre><code>q)ffill[args]
time         sym  ask bid asize bsize a id
------------------------------------------
00:00:00.000 AAPL 73  90  3     30    a 1
00:00:00.000 AMD  123 210 67    30    b 4
00:00:00.000 IBM  34  64  87    43    b 4
00:00:00.000 MSFT 100 200 43    40    c 1
00:00:38.184 AMD  121 12  3     30    a 1
00:01:25.332 AMD  121 3   3     30    b 4
00:09:37.574 AAPL 63  32  3     30    b 3
00:21:24.796 AAPL 63  32  12    30    b 4
00:38:39.521 AAPL 121 3   5     30    a 3
00:40:41.670 MSFT 63  3   43    20    c 4
00:48:08.048 MSFT 63  3   4     40    c 3
00:48:39.290 IBM  63  3   12    40    b 2
00:57:47.067 AAPL 121 24  3     30    a 2
..
</code></pre>

<h2 id="pivot">pivot[]</h2>
<p>Modified from:</p>
<p>http://code.kx.com/q/cookbook/pivoting-tables/#a-very-general-pivot-function-and-an-example</p>
<p>This script contains the utility to pivot a table, specifying the keyed columns, the columns
you wish to pivot around and the values you wish to expose. This utility takes a dictionary as
input with the following parameters:</p>
<ul>
<li>`table    - the table you want to pivot</li>
<li>`by   - the keyed columns</li>
<li>`piv  - the pivot columns</li>
<li>`var  - the variables you want to see</li>
<li>`f    - the function to create your column names (optional)</li>
<li>`g    - the function to sort your column names (optional)</li>
</ul>
<p>The optional function f is a function of var and piv which creates column names for your
pivoted table.
The optional function g is a function of the keyed columns, piv and the return of f, which
sorts the columns in ascending order.</p>
<h4 id="example_1">Example:</h4>
<p>We have a table of quotes:</p>
<pre><code>q)quote
date       sym  time         side level price    size
-----------------------------------------------------
2009.01.05 bafc 09:30:00.619 B    0     88.31803 96
2009.01.05 oljg 09:30:15.770 A    2     24.72941 14
2009.01.05 mgab 09:30:30.993 B    0     33.80173 2
2009.01.05 cflm 09:30:45.457 A    4     13.08412 98
2009.01.05 jgjm 09:31:00.668 B    0     80.2705  26
2009.01.05 cnkk 09:31:15.988 A    1     23.27025 38
..
</code></pre>

<p>We can key the table by date,sym and time, pivot around both side and level showing price 
and size at each time. The input dictionary is created in the following way:</p>
<pre><code>args:(`table`by`piv`v`f`g)!(q;`date`sym`time;`side`level;`price`size);
</code></pre>

<p>Here we are specifying the arguments for f and g as the default functions:</p>
<pre><code>// create _ separated column headers
f:{[v;P] `$&quot;_&quot; sv' string (v,()) cross P}
// return the headers in order
g:{[k;P;c] k,asc c}
</code></pre>

<p>The pivot function is then called and the output can be seen below:</p>
<pre><code>q)pivot[args]
date       sym  time        | price_A_0 price_A_1 price_A_2 price_A_3 price_A_4 price_B_0 price_B_1 price_B_2  price_B_3 price_B_4 size_A_0 size_A_1 size_A_2 size_A_3 size_A_4 size_B_0 size_B_1 size_B_2 size_B_3 size_B_4
----------------------------| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
2009.01.05 bafc 09:30:00.619|                                                   88.31803                                                                                        96
2009.01.05 bafc 10:05:30.395|                                                                                            60.77025                                                                                   73
2009.01.05 bafc 10:11:00.990|                                                                       0.03195086                                                                                    71
2009.01.05 bafc 10:41:00.031|                                                             68.8886                                                                                        60
2009.01.05 bafc 10:41:15.924|                     4.926275                                                                                           56
2009.01.05 bafc 11:06:30.361|                                                             84.28182                                                                                       10
2009.01.05 bafc 11:52:30.361|                                                   8.733561                                                                                        7
..
</code></pre>

<h4 id="example_2">Example:</h4>
<p>We have the following table showing some FX data:</p>
<pre><code>q)t
sym    time  price size lp   region
-----------------------------------
EURGBP 09:00 1     870  UBS  LON
EURGBP 09:07 7     296  BARX LON
EURGBP 09:19 3     850  BARX LON
EURGBP 09:27 1     540  HSBC NYC
EURUSD 09:31 4     995  UBS  LON
AUDUSD 09:38 0     396  HSBC NYC
EURUSD 09:41 6     152  UBS  LON
EURUSD 09:42 4     317  HSBC NYC
EURGBP 09:43 6     670  HSBC LON
EURGBP 09:47 7     345  BARX NYC
..
</code></pre>

<p>We want to see the different prices each liquidity provider has for each currency pair. For this we need to pivot the table t by sym around the lp's to show the various prices. We first create out parameter dictionary:</p>
<pre><code>args:(`table`by`piv`v)!(t;`sym;`lp;`price`size)
</code></pre>

<p>We then pass the dictionary into the pivot utility:</p>
<pre><code>q)pivot[args]
sym   | price_BARX price_HSBC price_UBS
------| -------------------------------
EURGBP| 7          1          1
EURUSD| 8          4          4
AUDUSD| 4          0          0

</code></pre>

<p>Another way to manipulate the same data would be to key the table by sym and lp (i.e. currency pair and liquidity provider) and pivot by region to show both price and size. Setting up this dictionary and passing it to the pivot function we see the result below:</p>
<pre><code>q)args:(`table`by`piv`v)!(t;`sym`lp;`region;`price`size)
q)pivot[args]
sym    lp  | price_LON price_NYC size_LON size_NYC
-----------| -------------------------------------
EURGBP UBS | 1         3         870      32
EURGBP BARX| 7         7         296      345
EURGBP HSBC| 6         1         670      540
EURUSD UBS | 4         1         995      494
AUDUSD HSBC| 5         0         879      396
EURUSD HSBC| 1         4         459      317
EURUSD BARX| 6         8         62       299
AUDUSD BARX| 4         2         817      716
AUDUSD UBS | 3         0         744      217

</code></pre>

<h2 id="intervals">intervals[]</h2>
<p>parameters:start,end,interval,round (optional)</p>
<p>The intervals.q utility in the .al namespace is used to output a
list of equally spaced intervals between given start and end points.</p>
<h4 id="usage">Usage</h4>
<p>Parameters should be passed in the form of a dictionary, where start
and end must be of the same type and interval can be either a long int
or of the same type as start and end (i.e if start:09:00 and end:12:00,
and intervals of 5 minutes were required interval could equal 05:00 or 5)</p>
<p>Allowed data types are:
date, month, time, minute, second, timestamp, timespan, integer, short, long</p>
<h4 id="examples">Examples</h4>
<h5 id="using-minute-datatype">Using minute datatype:</h5>
<pre><code>q)params:`start`end`interval`round!(09:32;12:00;00:30;0b)
q)intervals[params]
09:32 10:02 10:32 11:02 11:32
</code></pre>

<p>or with round applied.</p>
<pre><code>q)params:`start`end`interval`round!(09:32;12:00;00:30;1b)
q)intervals[params]
09:30 10:00 10:30 11:00 11:30 12:00
</code></pre>

<p>by default round is set to 1b, hence the result above can be
obtained without inputting a value for round via:</p>
<pre><code>q)params:`start`end`interval!(09:32;12:00;00:30)
q)intervals[params]
09:30 10:00 10:30 11:00 11:30 12:00
</code></pre>

<h4 id="some-examples-using-other-datatypes">Some examples using other datatypes:</h4>
<h5 id="date">Date</h5>
<pre><code>q)params:`start`end`interval!(2001.04.07;2001.05.01;5)
q)intervals[params]
2001.04.05 2001.04.10 2001.04.15 2001.04.20 2001.04.25 2001.04.30
</code></pre>

<p>and without rounding</p>
<pre><code>q)params:`start`end`interval`round!(2001.04.07;2001.05.01;5;0b)
q)intervals[params]
2001.04.07 2001.04.12 2001.04.17 2001.04.22 2001.04.27
</code></pre>

<h5 id="second">Second</h5>
<pre><code>q)params:`start`end`interval!(00:20:30 01:00:00 00:10:00)
q)intervals[params]
00:20:00 00:30:00 00:40:00 00:50:00 01:00:00
</code></pre>

<p>and without rounding</p>
<pre><code>q)params:`start`end`interval`round!(00:20:30 01:00:00 00:10:00)
q)intervals[params]
00:20:30 00:30:30 00:40:30 00:50:30
</code></pre>

<h5 id="timespan">timespan</h5>
<pre><code>q)params:`start`end`interval!(00:01:00.000000007;00:05:00.000000001;50000000000)
q)intervals[params]
0D00:00:50.000000000 0D00:01:40.000000000 0D00:02:30.000000000 0D00:03:20.000000000 0D00:04:10.000000000 0D00:05:00.000000000
</code></pre>

<h2 id="rack">rack[]</h2>
<p>The rack utility gives the user the ability to create a rack table
(the cross product of distinct values at the input).</p>
<h4 id="input-parameters">Input parameters:</h4>
<ul>
<li>table (required) - keyed or unkeyed in-memory table</li>
<li>keycols (required) - the columns of the table you want to create the rack from.</li>
<li>base (optional) - this is an additional table, against which the rack can be created</li>
<li>timeseries.start (optional) - start time to create a timeseries rack</li>
<li>timeseries.end (optional) - end time to create a time series rack</li>
<li>timeseries.interval (optional) - the interval for the time racking</li>
<li>timeseries.round (optional) - should rounding be carried out when creating the timeseries</li>
<li>fullexpansion (optional, default is 0b) - determines whether the required columns of input table will be expanded themselves or not.</li>
</ul>
<h4 id="usage_1">Usage</h4>
<ul>
<li>All the above arguments must be provided in dictionary form.</li>
<li>A timeseries is optional but if it is required then start, end, and timeseries  must be specified as a dictionary called 'timseries' (round remains optional with a default value of 1b).</li>
<li>Keyed tables can be provided, these will be unkeyed by the function and crossed as standard unkeyed tables.</li>
</ul>
<p>Should full expansion be required the function we use is:</p>
<pre><code>racktable:args[`base] cross (((0#args[`keycols]#args[`table]) upsert distinct (cross/)value flip args[`keycols]#args[`table]) cross timeseries);
</code></pre>

<p>Essentially the keycolumns are separated from the table and a cross-over is used on their values, this operation means
separating the values from the table headers so as a final step the distinct crossed values are upserted into an empty table made up of the key column names of the original table. The result is then crossed against a base and timeseries. If these aren't provided explicitly by the user they are simple null lists which have no effect on the output.</p>
<p>If full expansion isn't required the process is similar to the above but there's no expansion carried out on the initial table columns.</p>
<pre><code>     racktable:args[`base] cross ((args[`keycols]#args[`table]) cross timeseries)]
</code></pre>

<h4 id="examples_1">Examples</h4>
<ul>
<li>no fullexpansion, only table and keycols specified</li>
</ul>
<pre><code>q)t
sym exch price
--------------
a   nyse 1
b   nyse 2
a   cme  3

q)k
`sym`exch

create a dictionary
q)dic:`table`keycols!(t;k)

q)rack[dic]
sym exch
--------
a   nyse
b   nyse
a   cme
</code></pre>

<p>(simplest case, only returns unaltered keycols)</p>
<ul>
<li>timeseries,fullexpansion specified, table is a keyed table</li>
</ul>
<pre><code>q)dic
table        | (+(,`sym)!,`a`b`a)!+`exch`price!(`nyse`nyse`cme;1 2 3)
keycols      | `sym`exch
timeseries   | `start`end`interval!09:00 12:00 01:00
fullexpansion| 1b

q)rack[dic]
sym exch interval
-----------------
a   nyse 09:00
a   nyse 10:00
a   nyse 11:00
a   nyse 12:00
a   cme  09:00
a   cme  10:00
a   cme  11:00
a   cme  12:00
b   nyse 09:00
b   nyse 10:00
b   nyse 11:00
b   nyse 12:00
b   cme  09:00
b   cme  10:00
b   cme  11:00
b   cme  12:00
</code></pre>

<ul>
<li>timeseries,fullexpansion specified,base specified, table is keyed</li>
</ul>
<pre><code>q)dic
table        | (+(,`sym)!,`a`b`a)!+`exch`price!(`nyse`nyse`cme;1 2 3)
keycols      | `sym`exch
timeseries   | `start`end`interval!00:00:00 02:00:00 00:30:00
base         | +(,`base)!,`buy`sell`buy`sell
fullexpansion| 1b

q)rack[dic]
base sym exch interval
----------------------
buy  a   nyse 00:00:00
buy  a   nyse 00:30:00
buy  a   nyse 01:00:00
buy  a   nyse 01:30:00
buy  a   nyse 02:00:00
buy  a   cme  00:00:00
buy  a   cme  00:30:00
buy  a   cme  01:00:00
buy  a   cme  01:30:00
buy  a   cme  02:00:00
buy  b   nyse 00:00:00
buy  b   nyse 00:30:00
buy  b   nyse 01:00:00
buy  b   nyse 01:30:00
buy  b   nyse 02:00:00
buy  b   cme  00:00:00
buy  b   cme  00:30:00
buy  b   cme  01:00:00
buy  b   cme  01:30:00
buy  b   cme  02:00:00
</code></pre>
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../Processes/" title="Processes" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Processes
              </span>
            </div>
          </a>
        
        
          <a href="../visualisation/" title="Visualisation" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Visualisation
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy 2016 AquaQ Analytics Limited.  Kx &reg and kdb+ are registered trademarks of Kx Systems Inc.
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/AquaQAnalytics" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/AquaQAnalytics" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://www.linkedin.com/company/aquaq-analytics" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application-16f434a21a.js"></script>
      <script>var config={url:{base:".."}},app=new Application(config);app.initialize()</script>
      
    
    
      
      <script>!function(e,t,a,n,o,c,i){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,c=t.createElement(a),i=t.getElementsByTagName(a)[0],c.async=1,c.src=n,i.parentNode.insertBefore(c,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-51911331-4","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var t=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",t,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>